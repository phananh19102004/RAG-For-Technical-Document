version: "3.8"

services:
  retrieval:
    build: .
    env_file: .env
    command: ["bash", "-lc", "python retrieval_service.py"]
    volumes:
      - ./data:/app/data
      - chroma_data:/app/chroma_db
    expose:
      - "50051"

  generation:
    build: .
    env_file: .env
    command: ["bash", "-lc", "python generation_service.py"]
    expose:
      - "50052"

  gateway:
    build: .
    env_file: .env
    command: ["bash", "-lc", "uvicorn gateway_app:app --host 0.0.0.0 --port 8000"]
    ports:
      - "8000:8000"
    depends_on:
      - retrieval
      - generation

volumes:
  chroma_data:

